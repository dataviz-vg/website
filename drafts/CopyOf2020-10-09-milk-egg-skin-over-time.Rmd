---
title: "Worlwide Milk, Egg and Skin Production over the Years"
author: "Colin Fay"
date: 2020-10-08
slug: "worldwide-milk-egg-skin-production-over-years"
categories: ["industry"]
tags: ["livestock", "production", "industry"]
draft: true
params:
  table: milk-egg-skin-over-years.csv
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE, 
  echo = FALSE, 
  warning = FALSE, 
  message = FALSE
)
library(vegviz)
```

### `r emo::ji("mag_right")` About the source 

::: {.source}
Food and Agriculture Organization of the United Nations - _Livestock Primary_ dataset.
::: 

::: {.link}
[fao.org/faostat/en/#data/QL](https://www.fao.org/faostat/en/#data/QL)
:::

::: {.quote}
> 
:::

::: {.count}
> The data on livestock numbers are intended to cover all domestic animals irrespective of their age and the place or purpose of their breeding. Estimates have been made for non-reporting countries as well as for countries reporting incomplete data. However, in certain countries, data for chickens, ducks and turkeys do not yet seem to represent the total number of these birds. Certain other countries give a single figure for all poultry; data for these countries are shown under “Chickens”.
:::

```{r}
library(tidyverse)
library(magrittr)
if (!file.exists(
  params$table
)){
  # READ DATA HERE
  fls <- tempfile(fileext = ".zip")
  download.file("http://fenixservices.fao.org/faostat/static/bulkdownloads/Production_LivestockProcessed_E_All_Data.zip", fls)
  unzip(fls,exdir = dirname(fls))
  readr::read_csv(
    file.path(
      dirname(fls), "Production_LivestockProcessed_E_All_Data.csv"
    )
  ) %>%    
    select(-matches("Y....F$")) %>%
    select(-matches("Code")) %>%
    mutate(Item = tolower(Item)) %>%
    readr::write_csv(params$table)
}
source_table <- readr::read_csv(params$table)
```


### `r emo::ji("chart_with_upwards_trend")` Visualising the data

Visualization of _Livestock Primary_.
The data is filtered by Item, then the Production in tonnes is kept, grouped by year, and summed. 

```{r}
# DATA MANIP
adjust_and_draw <- function(
  item, 
  choice = "Production", 
  unit= "tonnes", 
  color = 1, 
  filter_total = TRUE
){
  adjusted_table <- source_table %>%  
    mutate(Item = tolower(Item)) %>%
    filter(grepl(item, Item)) %>%
    filter(Element == choice & Unit == unit) 
  if (filter_total){
    adjusted_table <- adjusted_table %>% filter(!grepl('total', Item))
  }
  adjusted_table <- adjusted_table %>%
    select(-matches("Y....F$")) %>%
    pivot_longer(
      names_to = "Year", 
      values_to = "Head", 
      cols = tidyselect::matches("Y....$")
    ) %>%
    mutate(
      #Head = Head * 1000, 
      Year = gsub("Y(....)", "\\1", Year), 
      Year = as.numeric(Year)
    ) %>%
    group_by(Year) %>%
    summarize(
      Head = sum(Head, na.rm = TRUE)
    )
  
  unit <- source_table %>% 
    mutate(Item = tolower(Item)) %>%
    filter(grepl(item, Item)) %>%
    filter(Element == choice & Unit == unit) %>% 
    pull(Unit) %>% 
    unique()
  gg <- adjusted_table %>%
    ggplot(aes(Year, Head)) + 
    geom_col(fill = viridis::viridis(6)[color]) + 
    labs(
      x = tools::toTitleCase(item), 
      y = sprintf(
        "Production in %s", 
        unit
      ), 
      labs = "Via @VegViz", 
      subtitle = "From: fao.org/faostat"
    ) +
    scale_y_continuous(labels = scales::comma) + 
    ggtheme()
  list(
    tbl  = adjusted_table, 
    gg = gg
  )
}

```


These visualizations will display the evolution of the production in tonnes of various livestock, from 1960 to 2018.

#### Milk production in tonnes

```{r fig.dim = c(12, 6)}
# VIZ
df <- adjust_and_draw("milk", color = 3)
df$gg + 
  labs(
    title = "Milk production over the years"
  )
```

`r details::details(knitr::kable(df$tbl, format = "html"), summary = "Show the data",lang  = NULL)`

#### Egg production in tonnes

```{r fig.dim = c(12, 6)}
# VIZ
df <- adjust_and_draw("eggs", color = 4)
df$gg + 
  labs(
    title = "Egg production over the years"
  )
```

`r details::details(knitr::kable(df$tbl, format = "html"), summary = "Show the data",lang  = NULL)`


#### Skins

```{r fig.dim = c(12, 6)}
# VIZ
df <- adjust_and_draw("skin", color = 6)
df$gg + 
  labs(
    title = "Skin production over the years"
  )
```

`r details::details(knitr::kable(df$tbl, format = "html"), summary = "Show the data",lang  = NULL)`

::: {.code}
Code behind this post is available `r build_link(knitr::current_input())`. 
:::
